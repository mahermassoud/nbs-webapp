"use strict";angular.module("ndexCravatWebappApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","mgcrea.ngStrap"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/analysis.html",controller:"AnalysisCtrl",controllerAs:"analysis"}).when("/analysis",{templateUrl:"views/analysis.html",controller:"AnalysisCtrl",controllerAs:"analysis"}).when("/visualize/:networkUUID",{templateUrl:"views/visualize.html",controller:"VisualizeCtrl",controllerAs:"visualize"}).when("/viewnicecx/:networkUUID",{templateUrl:"views/nicecx.html",controller:"NiceCxCtrl",controllerAs:"niceCx"}).when("/markNiceCX/:networkUUID",{templateUrl:"views/mark-nice-cx.html",controller:"MarkNiceCxCtrl",controllerAs:"markNiceCx"}).when("/niceCXtoRawCX/:networkUUID",{templateUrl:"views/nice-cx-to-raw-cx.html",controller:"NiceCxToRawCxCtrl",controllerAs:"niceCxToRawCx"}).otherwise({redirectTo:"/"})}]),angular.module("ndexCravatWebappApp").controller("AnalysisCtrl",["$scope","$http","sharedProperties","webServices",function(a,b,c,d){a.rankedNetworksList={};var e=a.rankedNetworksList;e.responseJSON=void 0,e.geneList="AURKB, foo, BRCA1, PCNA, AKT1, ITGB2",a.submit=function(){for(var f=e.geneList.split(","),g=0;g<f.length;g++)f[g]=f[g].trim();var h={ids:f,eset:"rudi_test"},i=JSON.stringify(h),j={method:"POST",url:d.getEnrichmentServiceURL(),headers:{"Content-Type":"application/json"},data:i};b(j).success(function(b){e.responseJSON=a.buildListOfEnrichedNetworks(b);var d={};d=a.normalizeResponseScores(b.scores),c.setResponseScores(d)}).error(function(a){console.log(a)})},a.normalizeResponseScores=function(a){var b={};if(!a)return b;for(var c=0;c<a.length;c++){var d=a[c],e=d.set_id;e in b||(b[e]=d)}return b},a.clearInput=function(){delete e.geneList,delete e.responseJSON},a.buildListOfEnrichedNetworks=function(a){if(console.log("in buildListOfEnrichedNetworks"),!a||!a.scores||0===a.scores.length)return"no networks found";for(var b="<br />",c=0;c<a.scores.length;c++){var d=a.scores[c],e=d.set_name,f=d.set_id,g=d.pv,h="";if(d.overlap)for(var i=Object.keys(d.overlap),j=0;j<i.length;j++){for(var k=i[j],l=d.overlap[k],m="",n=0;n<l.length;n++){var o=l[n];n>0&&(m+=", "),m+=o}j>0&&(h+=", "),h=h+k+"(IDs: "+m+")"}c>0&&(b+="<br /><br />"),b=b+"<strong>               PV : </strong>"+g+"<br /><strong>             Name : </strong>"+e+"<br /><strong>             UUID : </strong>"+f+"<br />"+(h?"<strong>          Overlap : </strong>"+h+"<br />":"")+'<strong>         Retrieve : </strong><a target="_blank" href="http://dev2.ndexbio.org/rest/network/'+f+'/asCX">Get Network in CX format</a><br /><strong>        Translate : </strong><a  target="_blank" href="#/viewnicecx/'+f+'">Translate network to Nice CX format</a><br /><strong>        Mark Nodes: </strong><a  target="_blank" href="#/markNiceCX/'+f+'">Mark inQuery Nodes in Nice CX </a><br /><strong>Nice CX -> Raw CX : </strong><a target="_blank" href="#/niceCXtoRawCX/'+f+'">Translate Nice CX with Marked Nodes back to Raw CX </a><br /><strong>        Visualize : </strong><a href="#/visualize/'+f+'">View Network</a>'}return b}}]),angular.module("ndexCravatWebappApp").controller("VisualizeCtrl",["$routeParams","$http","$scope","cyService","webServices","utils","cxNetworkUtils",function(a,b,c,d,e,f,g){var h=a.networkUUID;c.visualizer={};var i=c.visualizer;i.errorMessage=null;var j={method:"GET",url:e.getDev2NdexBioServiceURL()+"/"+h+"/asCX"};b(j).success(function(a){var b=g.rawCXtoNiceCX(a);console.log(b),f.markInQueryNodes(b,h);var c="cose",e={},i=d.cyElementsFromNiceCX(b,e);console.log(i),console.log(e);var j=d.cyStyleFromNiceCX(b,e);j||(j=d.getDefaultStyle()),d.allNodesHaveUniquePositions(i)&&(c="preset");var k={name:c};d.initCyGraphFromCyjsComponents(i,k,j),console.log(d.getCy())}).error(function(a){console.log("Error querying NDEx: "+JSON.stringify(a))})}]),angular.module("ndexCravatWebappApp").factory("cyService",["$q",function(a){var b,c={};const d="preset",e="cose",f=[{selector:"node",style:{"background-color":"rgb(0, 220, 200)","background-opacity":.8,width:"40px",height:"40px",label:"data(name)","font-family":"Roboto, sans-serif"}},{selector:"edge",style:{"line-color":"#aaaaaa",width:"2px",label:"data(interaction)","font-family":"Roboto, sans-serif","text-opacity":.8}},{selector:"node:selected",style:{"background-color":"yellow"}},{selector:"edge:selected",style:{"line-color":"yellow",width:6}}];c.getDefaultStyle=function(){return f};var g=function(a,b){var c=b[a];return c||(b[a]=a,c=a),c};return c.cyElementsFromNiceCX=function(a,b){var c={},d=[],e={},f=[],h={};return c.nodes=d,c.edges=f,a.nodes&&_.forEach(a.nodes.elements,function(a){var b=a["@id"],c={id:b};a.name&&(c.name=a.name),a.represents&&(c.represents=a.represents),e[b]={data:c}}),a.nodeAttributes&&_.forEach(a.nodeAttributes.nodes,function(a,c){var d=e[c];d&&_.forEach(a,function(a,c){var e=g(c,b);d.data[e]=a.v})}),a.cartesianLayout&&_.forEach(a.cartesianLayout.elements,function(a){var b=a.node,c=e[b];c.position={x:a.x,y:a.y}}),a.edges&&_.forEach(a.edges.elements,function(a){var b=a["@id"],c={id:b,source:a.s,target:a.t};a.i&&(c.interaction=a.i),h[b]={data:c}}),a.edgeAttributes&&_.forEach(a.edgeAttributes.elements,function(a){var c=a.po,d=h[c],e=g(a.n,b);d.data[e]=a.v}),_.forEach(e,function(a){d.push(a)}),_.forEach(h,function(a){f.push(a)}),c},c.cyStyleFromNiceCX=function(a,b){return console.log("style from niceCX: "+a.length+" "+b.length),!1},c.allNodesHaveUniquePositions=function(a){for(var b={},c=a.nodes,d=0;d<c.length;d++){var e=c[d],f=e.position;if(!f)return!1;var g=f.x+"_"+f.y;if(b[g])return!1;b[g]=f}return!0},c.initCyGraph=function(c){var g=a.defer(),h=d,i=c.style;(void 0===i||null===i)&&(i=f,h=e);var j={name:h};return $(function(){b=cytoscape({container:document.getElementById("cytoscape-canvas"),style:i,layout:j,elements:c.elements,ready:function(){g.resolve(this)}})}),g.promise},c.initCyGraphFromCyjsComponents=function(c,d,e){var f=a.defer();return $(function(){b=cytoscape({container:document.getElementById("cytoscape-canvas"),style:e,layout:d,elements:c,ready:function(){f.resolve(this)}})}),f.promise},c.setCyjsNetwork=function(a){console.log("about to set style and layout");var c=d,g=a.style;(void 0===g||null===g)&&(g=f,c=e),b.style(g),b.layout({name:c}),console.log("about to load elements")},c.getCy=function(){return b},c}]),angular.module("ndexCravatWebappApp").service("cxNetworkUtils",function(){this.rawCXtoNiceCX=function(b){for(var c={},d=0;d<b.length;d++){var e=b[d];if(e){var f;for(f in e){var g=e[f];if("numberVerification"!==f)if("status"!==f)if("metaData"!==f)for(var h=0;h<g.length;h++){var i=g[h];a(f,i,c)}else c.preMetaData?c.postMetaData||(c.postMetaData=e):c.preMetaData=e;else c.status||(c.status=e);else c.numberVerification||(c.numberVerification=e)}}}return c},this.niceCXToRawCX=function(a){var b=[];a.numberVerification&&b.push(a.numberVerification),a.preMetaData&&b.push(a.preMetaData);for(var c in a)if("preMetaData"!==c&&"postMetaData"!==c&&"numberVerification"!==c&&"status"!==c)if("nodeAttributes"===c)for(var d=Object.keys(a[c].nodes),e=0;e<d.length;e++)for(var f=d[e],g=a[c].nodes[f],h=Object.keys(g),i=0;i<h.length;i++){var j=h[i],k=g[j],l={po:f,n:j,v:k.v};k.d&&(l.d=k.d);var m={nodeAttributes:[l]};b.push(m)}else for(var n=a[c].elements,o=0;o<n.length;o++){var p=n[o],q={};q[c]=[],q[c].push(p),b.push(q)}return a.postMetaData&&b.push(a.postMetaData),a.status&&b.push(a.status),b},this.setNodeAttribute=function(a,b,c,d,e){if(c&&d){var f={v:d};e&&(f.d=e),a.nodeAttributes.nodes[b]||(a.nodeAttributes.nodes[b]={}),a.nodeAttributes.nodes[b][c]=f}};var a=function(a,b,c){var d=c[a];if("nodeAttributes"===a){d||(d={nodes:{}},c[a]=d);var e=d.nodes,f=e[b.po];f||(f={},e[b.po]=f),f[b.n]={v:b.v,d:b.d}}else{d||(d={elements:[]},c[a]=d);var g=d.elements;g.push(b)}}}),angular.module("ndexCravatWebappApp").controller("NiceCxCtrl",["$scope","$routeParams","$http","cxNetworkUtils","cyService","webServices",function(a,b,c,d,e,f){var g=b.networkUUID;a.network={};var h=a.network,i={method:"GET",url:f.getDev2NdexBioServiceURL()+"/"+g+"/asCX"};c(i).success(function(a){h.niceCX=JSON.stringify(d.rawCXtoNiceCX(a),null,2)}).error(function(a){console.log(a)})}]),angular.module("ndexCravatWebappApp").service("sharedProperties",function(){return{getAllResponseScores:function(){var a=JSON.parse(sessionStorage.getItem("responseScores"));return a},getResponseScores:function(a){var b=this.getAllResponseScores();return b[a]},setResponseScores:function(a){var b=JSON.stringify(a);sessionStorage.setItem("responseScores",b)}}}),angular.module("ndexCravatWebappApp").service("webServices",function(){var a="http://enrich.ndexbio.org/enrich/v1/api/esets/query",b="http://ci-dev-serv.ucsd.edu:3001/cx2cyjs",c="http://dev2.ndexbio.org/rest/network";return{getEnrichmentServiceURL:function(){return a},getCx2CyJsServiceURL:function(){return b},getDev2NdexBioServiceURL:function(){return c}}}),angular.module("ndexCravatWebappApp").controller("MarkNiceCxCtrl",["$scope","$routeParams","$http","cxNetworkUtils","cyService","webServices","sharedProperties","utils",function(a,b,c,d,e,f,g,h){var i=b.networkUUID;a.network={};var j=a.network,k={method:"GET",url:f.getDev2NdexBioServiceURL()+"/"+i+"/asCX"};c(k).success(function(a){var b=d.rawCXtoNiceCX(a);h.markInQueryNodes(b,i),j.niceCXwithInQueryNodesMarked=JSON.stringify(b,null,2)}).error(function(a){console.log(a)})}]),angular.module("ndexCravatWebappApp").controller("NiceCxToRawCxCtrl",["$scope","$routeParams","$http","cxNetworkUtils","webServices","utils",function(a,b,c,d,e,f){var g=b.networkUUID;a.network={};var h=a.network,i={method:"GET",url:e.getDev2NdexBioServiceURL()+"/"+g+"/asCX"};c(i).success(function(a){var b=d.rawCXtoNiceCX(a);f.markInQueryNodes(b,g);var c=d.niceCXToRawCX(b);h.rawCXwithMarkedNodes=JSON.stringify(c,null,2)}).error(function(a){console.log(a)})}]),angular.module("ndexCravatWebappApp").service("utils",["sharedProperties","cxNetworkUtils",function(a,b){this.markInQueryNodes=function(c,d){var e=a.getResponseScores(d),f=[];if(e&&e.overlap)for(var g in e.overlap){var h=e.overlap[g];for(var i in h)f.push(h[i])}for(var j=0;j<f.length;j++){var k=f[j];b.setNodeAttribute(c,k,"inQuery","true")}}}]),angular.module("ndexCravatWebappApp").run(["$templateCache",function(a){a.put("views/analysis.html",'<div class="row"> <!-- Left Column --> <div class="col-md-3"> <div class="panel panel-info"> <div class="panel-heading"> Gene List for Cravat </div> <div class="panel-body"> <!--<form ng-submit="submit()" ng-controller="AnalysisCtrl" id="analysisCtrlForm">--> <textarea style="resize:none; width:100%" rows="5" ng-model="rankedNetworksList.geneList">\n                    </textarea> <input type="submit" class="btn btn-default" id="submit" ng-disabled="!rankedNetworksList.geneList" ng-click="submit()" value="Submit"> <input type="reset" class="btn btn-default" ng-disabled="!rankedNetworksList.geneList" value="Clear" ng-click="clearInput()"> <!-- </form>--> </div> </div> </div> <!-- Right Column --> <div class="col-md-9"> <div> <strong>Visualize Test : </strong><a href="#/visualize/11c898a7-feb6-11e5-a5bc-0660b7976219">\' + "a6b1 and a6b4" </a>\' </div> <div class="panel panel-info"> <div class="panel-heading"> Ranked List Of Networks From Cravat </div> <div class="panel-body"> <pre ng-show="rankedNetworksList.responseJSON">\n                  <span ng-bind-html="rankedNetworksList.responseJSON"></span>\n               </pre> </div> </div> </div> </div>'),a.put("views/mark-nice-cx.html",'<div style="word-wrap: break-word; white-space: pre-wrap; font-family: monospace"> {{network.niceCXwithInQueryNodesMarked}} </div>'),a.put("views/nice-cx-to-raw-cx.html",'<div style="word-wrap: break-word; white-space: pre-wrap; font-family: monospace"> {{network.rawCXwithMarkedNodes}} </div>'),a.put("views/nicecx.html",'<div style="word-wrap: break-word; white-space: pre-wrap; font-family: monospace"> {{network.niceCX}} </div>'),a.put("views/visualize.html",'<div class="row"> <!-- One column only that takes all screen  --> <div class="col-md-12"> <div class="panel panel-info"> <div class="panel-heading"> Visualizing Network </div> <div class="panel-body"> <div ng-if="visualizer.errorMessage" ng-bind-html="visualizer.errorMessage" class="alert alert-danger"></div> <div ng-if="!visualizer.errorMessage" class="cytoscape-canvas" id="cytoscape-canvas"></div> </div> </div> </div> </div>')}]);